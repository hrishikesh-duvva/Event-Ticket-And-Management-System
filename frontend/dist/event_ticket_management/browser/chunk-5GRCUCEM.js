import{a as N}from"./chunk-EVO7D32F.js";import"./chunk-G5KA7DMQ.js";import{f as P,h as D,l as R}from"./chunk-LKO6ZGM4.js";import{Ka as g,Na as c,Oa as S,Qa as l,Ra as t,Sa as f,Vb as y,Wa as _,Wb as w,X as k,Xa as v,Ya as s,_b as O,da as x,ea as b,ec as T,fb as n,fc as M,gb as C,hb as p,nb as E,ua as I,ya as r,za as h}from"./chunk-A5IQK4TJ.js";import"./chunk-JHI3MBHO.js";function V(d,i){d&1&&(l(0,"div",6)(1,"h2"),n(2,"Event Details Not Found :( "),f(3,"br"),n(4," Wrong ID used maybe :("),t()())}function $(d,i){if(d&1){let e=_();l(0,"div",18),v("click",function(){let a=x(e).$implicit,m=s(2);return b(m.onSelectSchedule(a.scheduleId))}),l(1,"p")(2,"strong"),n(3,"Session:"),t(),n(4),t(),l(5,"p")(6,"strong"),n(7,"Start Time:"),t(),n(8),t(),l(9,"p")(10,"strong"),n(11,"End Time:"),t(),n(12),t(),l(13,"p")(14,"strong"),n(15,"Guest:"),t(),n(16),t()()}if(d&2){let e=i.$implicit,o=s(2);S("selected",e.scheduleId===o.selectedScheduleId),r(4),p(" ",e.sessionName,""),r(4),p(" ",e.startTime,""),r(4),p(" ",e.endTime,""),r(4),p(" ",e.speakerName,"")}}function B(d,i){if(d&1){let e=_();l(0,"button",19),v("click",function(){x(e);let a=s(2);return b(a.onBookTickets())}),n(1," Book Tickets "),t()}if(d&2){let e=s(2);c("disabled",!e.selectedScheduleId)}}function z(d,i){if(d&1){let e=_();l(0,"button",20),v("click",function(){x(e);let a=s(2);return b(a.onDeleteSchedule())}),n(1," Delete Schedule "),t()}if(d&2){let e=s(2);c("disabled",!e.selectedScheduleId)}}function A(d,i){if(d&1&&(l(0,"div",7)(1,"div",8)(2,"div",9),f(3,"img",10),l(4,"h1",11),n(5),t(),l(6,"p")(7,"strong"),n(8,"Location:"),t(),n(9),t(),l(10,"p")(11,"strong"),n(12,"Description:"),t(),n(13),t()(),l(14,"div",12)(15,"h3",13),n(16,"Schedules"),t(),l(17,"div",14),g(18,$,17,6,"div",15),t(),g(19,B,2,1,"button",16)(20,z,2,1,"button",17),t()()()),d&2){let e=s();r(3),c("src",e.event.eventImage,I),r(2),C(e.event.name),r(4),p(" ",e.event.location,""),r(4),p(" ",e.event.description,""),r(5),c("ngForOf",e.schedules),r(),c("ngIf",e.userRole!=="Admin"),r(),c("ngIf",e.userRole==="Admin")}}var F=class d{constructor(i,e,o,a){this.router=i;this.route=e;this.eventService=o;this.http=a}id=0;event=null;schedules=[];selectedScheduleId=null;isEventLoaded=!1;userRole=null;apiUrl="http://localhost:5095/api/schedules/schedule/";ngOnInit(){this.route.paramMap.subscribe(i=>{let e=i.get("id");e!=null&&(this.id=+e,this.eventService.getEventById(this.id).subscribe(o=>{o&&(this.isEventLoaded=!0,this.event=o,o.schedules.$values.map(m=>m.scheduleId).forEach(m=>{this.eventService.getScheduleById(m).subscribe(u=>{this.schedules.push({scheduleId:u.scheduleId,sessionName:u.sessionName,startTime:u.startTime,endTime:u.endTime,speakerName:u.speakerName,capacity:u.capacity})})}))}))})}checkUserRole(){let i=localStorage.getItem("token");if(i){let e=this.decodeJwt(i);this.userRole=e?.UserRole||null}}decodeJwt(i){try{let e=i.split(".");if(e.length===3){let o=atob(e[1]);return JSON.parse(o)}}catch(e){console.error("Failed to decode JWT:",e)}return null}onSelectSchedule(i){this.selectedScheduleId=i}onBookTickets(){this.selectedScheduleId?this.router.navigate([`/events/seat-selection/${this.id}/${this.selectedScheduleId}`]):alert("Please select a schedule to book tickets.")}onDeleteSchedule(){if(this.selectedScheduleId){let i=new T().set("Authorization",`Bearer ${localStorage.getItem("token")}`),e=`${this.apiUrl}${this.selectedScheduleId}`;this.http.delete(e,{headers:i}).subscribe({next:()=>{alert("Schedule deleted successfully!"),this.schedules=this.schedules.filter(o=>o.scheduleId!==this.selectedScheduleId),this.selectedScheduleId=null},error:o=>{console.error("Failed to delete schedule:",o),alert("Failed to delete the schedule.")}})}else alert("Please select a schedule to delete.")}static \u0275fac=function(e){return new(e||d)(h(D),h(P),h(N),h(M))};static \u0275cmp=k({type:d,selectors:[["app-event-detail"]],standalone:!0,features:[E],decls:7,vars:2,consts:[[1,"card"],["class","card-header",4,"ngIf"],["class","card-body",4,"ngIf"],[1,"card-footer"],[1,"btn","btn-outline-secondary","back-button",3,"click"],[1,"fa","fa-chevron-left"],[1,"card-header"],[1,"card-body"],[1,"content-container"],[1,"left-section"],["alt","Event Poster",1,"event-image",3,"src"],[1,"event-title"],[1,"right-section"],[1,"schedules-title"],[1,"schedule-grid"],["class","schedule-card",3,"selected","click",4,"ngFor","ngForOf"],["class","btn btn-primary mt-4 book-ticket-button",3,"disabled","click",4,"ngIf"],["class","btn btn-danger mt-4 delete-schedule-button",3,"disabled","click",4,"ngIf"],[1,"schedule-card",3,"click"],[1,"btn","btn-primary","mt-4","book-ticket-button",3,"click","disabled"],[1,"btn","btn-danger","mt-4","delete-schedule-button",3,"click","disabled"]],template:function(e,o){e&1&&(l(0,"div",0),g(1,V,5,0,"div",1)(2,A,21,7,"div",2),l(3,"div",3)(4,"button",4),v("click",function(){return o.router.navigate(["/"])}),f(5,"i",5),n(6," Back "),t()()()),e&2&&(r(),c("ngIf",!o.isEventLoaded),r(),c("ngIf",o.isEventLoaded))},dependencies:[O,y,w,R],styles:[".card-body[_ngcontent-%COMP%]{padding:20px}.content-container[_ngcontent-%COMP%]{display:flex;justify-content:space-between;flex-wrap:wrap;gap:20px}.left-section[_ngcontent-%COMP%]{flex:1;max-width:40%;padding:20px;text-align:left;border-right:1px solid #dee2e6}.event-image[_ngcontent-%COMP%]{width:100%;max-width:300px;height:auto;border-radius:10px;margin-bottom:20px;box-shadow:0 5px 10px #0000001a}.event-title[_ngcontent-%COMP%]{font-size:24px;font-weight:700;margin-bottom:10px}.right-section[_ngcontent-%COMP%]{flex:2;padding:20px}.schedules-title[_ngcontent-%COMP%]{font-size:20px;font-weight:700;margin-bottom:20px}.schedule-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(2,1fr);gap:20px}.schedule-card[_ngcontent-%COMP%]{background-color:#f8f9fa;border:1px solid #dee2e6;border-radius:8px;padding:15px;cursor:pointer;transition:transform .2s,box-shadow .2s;text-align:left}.schedule-card[_ngcontent-%COMP%]:hover{transform:translateY(-3px);box-shadow:0 8px 20px #00000026}.schedule-card.selected[_ngcontent-%COMP%]{border:2px solid #007bff;background-color:#e9f7fd}.schedule-card[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:5px 0;font-size:14px;color:#495057}.book-ticket-button[_ngcontent-%COMP%]{display:block;margin:20px auto 0;background-color:#007bff;border-color:#007bff;color:#fff;border-radius:8px;padding:10px 15px;font-size:16px;font-weight:700;text-align:center;transition:background-color .2s,box-shadow .2s;max-width:200px}.book-ticket-button[_ngcontent-%COMP%]:disabled{background-color:#d6d8db;cursor:not-allowed}.book-ticket-button[_ngcontent-%COMP%]:hover:enabled{background-color:#0056b3;box-shadow:0 8px 20px #00000026}.back-button[_ngcontent-%COMP%]{display:inline-block;width:100px;text-align:center;border-radius:8px}"]})};export{F as EventDetailComponent};
