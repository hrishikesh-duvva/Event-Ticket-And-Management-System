import{a as q}from"./chunk-G5KA7DMQ.js";import{e as R,h as B,k as U,l as H,m as G,s as W}from"./chunk-C7UFNYZC.js";import{f as z,h as A}from"./chunk-LKO6ZGM4.js";import{Ka as v,N as C,Na as u,Oa as P,Qa as s,Ra as n,S as I,Ub as V,Vb as $,Wa as _,Wb as j,X as T,Xa as b,Ya as l,da as h,ea as f,eb as M,fb as a,fc as S,gb as k,hb as g,jb as E,kb as O,lb as D,nb as w,qb as F,ub as N,ya as r,za as x}from"./chunk-A5IQK4TJ.js";import"./chunk-JHI3MBHO.js";var y=class o{constructor(e){this.http=e}seatingUrl="http://localhost:5095/api/seating";bookingUrl="http://localhost:5095/api/TicketBooking/book-ticket";getSeats(e,t){return this.http.get(`${this.seatingUrl}/event/${e}/schedule/${t}`)}getTicketPrices(e){return this.http.get(`http://localhost:5095/api/tickettypes/event/${e}`)}bookTickets(e,t,i,c,d,p){let m={customerId:e,scheduleId:t,seatIds:i,ticketTypeId:c,quantity:d,paymentMethod:p};return this.http.post(this.bookingUrl,m)}static \u0275fac=function(t){return new(t||o)(I(S))};static \u0275prov=C({token:o,factory:o.\u0275fac,providedIn:"root"})};var Q=(o,e)=>({"btn-secondary":o,"btn-success":e});function X(o,e){if(o&1){let t=_();s(0,"div",3)(1,"p"),a(2),n(),s(3,"button",4),b("click",function(){h(t);let c=l();return f(c.navigateToRegistration())}),a(4,"Register"),n()()}if(o&2){let t=l();r(2),k(t.notAuthenticatedMessage)}}function Z(o,e){if(o&1){let t=_();s(0,"div",27),b("click",function(){let c=h(t).$implicit,d=l(3);return f(d.toggleSeatSelection(c))}),a(1),n()}if(o&2){let t=e.$implicit,i=l(3);P("booked",t.availabilityStatus===1)("selected",i.selectedSeats.includes(t))("vip",t.section==="VIP")("general",t.section==="General"),r(),g(" ",t.seatNumber," ")}}function ee(o,e){if(o&1&&(s(0,"div")(1,"div",25),v(2,Z,2,9,"div",26),n()()),o&2){let t=e.$implicit;r(2),u("ngForOf",t)}}function te(o,e){if(o&1){let t=_();s(0,"li",30)(1,"span")(2,"strong"),a(3),n(),a(4),n(),s(5,"button",31),b("click",function(){let c=h(t).$implicit,d=l(3);return f(d.applyDiscount(c))}),a(6),n()()}if(o&2){let t=e.$implicit,i=l(3);r(3),k(t.discountCode),r(),g(" - ",t.discountPercentage,"% off "),r(),u("ngClass",F(4,Q,(i.appliedDiscount==null?null:i.appliedDiscount.discountId)!==t.discountId,(i.appliedDiscount==null?null:i.appliedDiscount.discountId)===t.discountId)),r(),g(" ",(i.appliedDiscount==null?null:i.appliedDiscount.discountId)===t.discountId?"Remove":"Apply"," ")}}function ie(o,e){if(o&1&&(s(0,"div")(1,"ul",28),v(2,te,7,7,"li",29),n()()),o&2){let t=l(2);r(2),u("ngForOf",t.discounts)}}function ne(o,e){o&1&&(s(0,"p"),a(1,"No discounts available for this event."),n())}function oe(o,e){if(o&1){let t=_();s(0,"div",5)(1,"h1"),a(2,"Seat Selection"),n(),s(3,"div",6),v(4,ee,3,1,"div",7),n(),s(5,"div",8)(6,"div",9)(7,"h2",10),a(8,"\u{1F39F}\uFE0F Ticket Information"),n(),s(9,"div",11)(10,"p")(11,"strong"),a(12,"Selected Ticket Type:"),n(),a(13),n(),s(14,"p")(15,"strong"),a(16,"Total Price:"),n(),a(17),n()()(),s(18,"div",12)(19,"h2"),a(20,"\u{1F4B8} Available Discounts"),n(),v(21,ie,3,1,"div",13)(22,ne,2,0,"ng-template",null,0,N),n(),s(24,"div",14)(25,"h2",10),a(26,"\u{1F4B3} Payment Method"),n(),s(27,"label",15),a(28,"Select Payment Method:"),n(),s(29,"select",16),D("ngModelChange",function(c){h(t);let d=l();return O(d.paymentMethod,c)||(d.paymentMethod=c),f(c)}),s(30,"option",17),a(31,"Select"),n(),s(32,"option",18),a(33,"Credit Card"),n(),s(34,"option",19),a(35,"Debit Card"),n(),s(36,"option",20),a(37,"UPI"),n(),s(38,"option",21),a(39,"Net Banking"),n()()(),s(40,"div",22)(41,"p",23)(42,"strong"),a(43,"Selected Seats:"),n(),a(44),n(),s(45,"button",24),b("click",function(){h(t);let c=l();return f(c.bookTickets(c.paymentMethod))}),a(46," \u{1F39F}\uFE0F Book Tickets "),n()()()()}if(o&2){let t=M(23),i=l();r(4),u("ngForOf",i.organizedSeats),r(9),g(" ",i.selectedTicketType||"None",""),r(4),g(" \u20B9",i.totalPrice,""),r(4),u("ngIf",i.discounts.length>0)("ngIfElse",t),r(8),E("ngModel",i.paymentMethod),r(15),g(" ",i.selectedSeatNumbers,""),r(),u("disabled",i.selectedSeats.length===0||!i.paymentMethod)}}var Y=class o{constructor(e,t,i,c){this.route=e;this.seatService=t;this.router=i;this.http=c}eventId;scheduleId;seats=[];organizedSeats=[];selectedSeats=[];maxSelection=6;isAuthenticated=!0;notAuthenticatedMessage="You are not logged in. Please register or log in to continue.";ticketPrices={};totalPrice=0;selectedTicketType=null;paymentMethod="";discounts=[];discountCode="";appliedDiscount=null;ngOnInit(){try{this.getCustomerIdFromToken()}catch(e){console.error(e),this.isAuthenticated=!1}this.route.paramMap.subscribe(e=>{this.eventId=+e.get("eventId"),this.scheduleId=+e.get("scheduleId"),this.fetchSeats(),this.fetchTicketPrices(),this.fetchDiscounts()})}fetchSeats(){this.seatService.getSeats(this.eventId,this.scheduleId).subscribe(e=>{e&&e.$values?(this.seats=e.$values,this.organizeSeats()):console.error("No seats data found")},e=>{console.error("Error fetching seats:",e)})}organizeSeats(){let e=this.seats.filter(i=>i.section==="VIP"),t=this.seats.filter(i=>i.section==="General");this.organizedSeats=[...this.groupSeats(e,10),...this.groupSeats(t,20)]}groupSeats(e,t){let i=[];for(let c=0;c<e.length;c+=t)i.push(e.slice(c,c+t));return i}fetchTicketPrices(){this.seatService.getTicketPrices(this.eventId).subscribe(e=>{e&&e.$values?e.$values.forEach(t=>{this.ticketPrices[t.ticketTypee===0?"VIP":"General"]=t.price}):console.error("No ticket prices data found")},e=>{console.error("Error fetching ticket prices:",e)})}fetchDiscounts(){this.http.get(`http://localhost:5095/api/discounts/event/${this.eventId}`).subscribe(e=>{e&&e.$values?(this.discounts=e.$values,console.log("Fetched Discounts:",this.discounts)):console.error("No discounts data found in response.")},e=>{console.error("Error fetching discounts:",e)})}applyDiscount(e){this.appliedDiscount?.discountId===e.discountId?(this.appliedDiscount=null,this.calculateTotalPrice(),alert("Discount removed.")):e?(this.appliedDiscount=e,this.calculateTotalPrice(),alert(`Discount applied: ${e.discountCode} (${e.discountPercentage}%)`)):alert("This discount is not applicable for the selected ticket type.")}toggleSeatSelection(e){if(e.availabilityStatus===0){let t=e.section;if(this.selectedTicketType&&this.selectedTicketType!==t&&this.selectedSeats.length>0){alert(`You can only select ${this.selectedTicketType} seats.`);return}this.selectedSeats.includes(e)?(this.selectedSeats=this.selectedSeats.filter(i=>i!==e),this.selectedSeats.length===0&&(this.selectedTicketType=null)):this.selectedSeats.length<this.maxSelection&&(this.selectedSeats.push(e),this.selectedTicketType=t),this.calculateTotalPrice()}}calculateTotalPrice(){let e=this.selectedTicketType,t=0;if(e&&this.ticketPrices[e]!==void 0&&(t=this.selectedSeats.length*this.ticketPrices[e]),this.appliedDiscount){let i=this.appliedDiscount.discountPercentage||0;this.totalPrice=t-t*i/100}else this.totalPrice=t}get selectedSeatNumbers(){return this.selectedSeats.map(e=>e.seatNumber).join(", ")}getCustomerIdFromToken(){let e=localStorage.getItem("token");if(e)try{let t=q(e);return console.log("Decoded Token:",t),+t.UserId}catch(t){throw console.error("Invalid token:",t),new Error("Failed to decode token")}throw new Error("User not authenticated: Token not found")}bookTickets(e){if(this.selectedSeats.length>0){let t=this.getCustomerIdFromToken(),i=this.selectedSeats.map(m=>m.seatingId),c=this.selectedSeats[0].ticketTypeId,d=this.selectedSeats.length,p={customerId:t,scheduleId:this.scheduleId,seatIds:i,ticketTypeId:c,quantity:d,paymentMethod:e};console.log("Payload being sent:",p),this.seatService.bookTickets(p.customerId,p.scheduleId,p.seatIds,p.ticketTypeId,p.quantity,p.paymentMethod).subscribe(m=>{console.log("Response:",m),alert("Tickets booked successfully!"),this.router.navigate(["/"])},m=>{console.error("Error during booking:",m),alert("Error booking tickets: "+m.message)})}else alert("No seats selected!")}navigateToRegistration(){this.router.navigate(["/Customer/register"])}static \u0275fac=function(t){return new(t||o)(x(z),x(y),x(A),x(S))};static \u0275cmp=T({type:o,selectors:[["app-seat"]],standalone:!0,features:[w],decls:2,vars:2,consts:[["noDiscounts",""],["class","not-authenticated",4,"ngIf"],["class","seat-container",4,"ngIf"],[1,"not-authenticated"],[1,"btn","btn-primary",3,"click"],[1,"seat-container"],[1,"seating-grid"],[4,"ngFor","ngForOf"],[1,"info-and-payment"],[1,"ticket-info"],[1,"section-heading"],[1,"info-details"],[1,"discount-section"],[4,"ngIf","ngIfElse"],[1,"payment-method"],["for","payment"],["id","payment",1,"payment-select",3,"ngModelChange","ngModel"],["value","","disabled","","selected",""],["value","CreditCard"],["value","DebitCard"],["value","UPI"],["value","NetBanking"],[1,"action-container"],[1,"selected-seats"],[1,"btn","btn-primary","book-ticket-button",3,"click","disabled"],[1,"row"],["class","seat",3,"booked","selected","vip","general","click",4,"ngFor","ngForOf"],[1,"seat",3,"click"],[1,"discount-list"],["class","discount-item",4,"ngFor","ngForOf"],[1,"discount-item"],[1,"btn","discount-btn",3,"click","ngClass"]],template:function(t,i){t&1&&v(0,X,5,1,"div",1)(1,oe,47,8,"div",2),t&2&&(u("ngIf",!i.isAuthenticated),r(),u("ngIf",i.isAuthenticated))},dependencies:[W,H,G,U,R,B,$,j,V],styles:[".not-authenticated[_ngcontent-%COMP%]{text-align:center;margin-top:20px}.not-authenticated[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:18px;color:red}.not-authenticated[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-top:10px}.seat-container[_ngcontent-%COMP%]{text-align:center;margin:20px auto}.seating-grid[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:15px;margin-top:20px}.row[_ngcontent-%COMP%]{display:flex;justify-content:center;gap:10px}.seat[_ngcontent-%COMP%]{width:50px;height:50px;border:1px solid #ccc;border-radius:5px;display:flex;align-items:center;justify-content:center;cursor:pointer;background-color:#f8f8f8;transition:transform .3s}.seat.vip[_ngcontent-%COMP%]{background-color:#ffe4b5}.seat.general[_ngcontent-%COMP%]{background-color:#e0f7fa}.seat.booked[_ngcontent-%COMP%]{background-color:#fcc;cursor:not-allowed}.seat.selected[_ngcontent-%COMP%]{border:2px solid #007bff;background-color:#d6e4ff}.info-and-payment[_ngcontent-%COMP%]{margin-top:30px;padding:25px;max-width:600px;border:2px solid #ddd;border-radius:12px;background-color:#fff;box-shadow:0 4px 10px #0000001a;text-align:center;margin-left:auto;margin-right:auto}.section-heading[_ngcontent-%COMP%]{font-size:20px;margin-bottom:15px;color:#333;text-align:center}.info-details[_ngcontent-%COMP%]{margin-bottom:20px;font-size:16px}.discount-section[_ngcontent-%COMP%]{margin-top:20px}.discount-list[_ngcontent-%COMP%]{list-style-type:none;padding:0}.discount-item[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;padding:10px;background-color:#f9f9f9;border:1px solid #ddd;border-radius:8px}.discount-btn[_ngcontent-%COMP%]{padding:5px 10px;font-size:14px}.payment-method[_ngcontent-%COMP%]{margin-top:20px}.payment-method[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{margin-left:10px;padding:8px;border-radius:5px;border:1px solid #ccc;font-size:14px}.selected-seats[_ngcontent-%COMP%]{margin-top:20px;font-size:16px}.book-ticket-button[_ngcontent-%COMP%]{margin-top:20px;padding:12px 24px;font-size:16px;font-weight:700;background-color:#007bff;border:none;border-radius:8px;color:#fff;cursor:pointer}.book-ticket-button[_ngcontent-%COMP%]:disabled{background-color:#ddd;cursor:not-allowed}"]})};export{Y as SeatComponent};
